# Bot DAATCS - Sistema de Gestión de Pedidos 🤖

Bot de WhatsApp optimizado para gestionar pedidos, compatible con **Railway** (nube) y **Termux** (local).

## 🌟 Características

- ✅ **Dual Environment**: Funciona en Railway y Termux
- ✅ **QR en Terminal**: Para Termux con `qrcode-terminal`
- ✅ **Sistema de Pedidos**: Gestión completa de órdenes
- ✅ **Base de Datos JSON**: Sin dependencias externas
- ✅ **Estados Personalizables**: Workflow completo de pedidos
- ✅ **Notificaciones Automáticas**: Al cliente y administradores
- ✅ **Protecciones Anti-Ban**: Límites y delays inteligentes
- ✅ **Backup Automático**: Base de datos protegida

## 🚀 Instalación Rápida - Termux

### Método Automático (Recomendado):
```bash
# Descargar e ejecutar instalador
wget -O - https://raw.githubusercontent.com/JR23CR/bot-daatcs-railway/main/install-termux.sh | bash
```

### Método Manual:
```bash
# 1. Preparar Termux
termux-setup-storage
apt update && apt upgrade -y
pkg install -y nodejs npm git python chromium

# 2. Clonar repositorio
cd ~
git clone https://github.com/JR23CR/bot-daatcs-railway.git bot-daatcs
cd bot-daatcs

# 3. Instalar dependencias
npm install

# 4. Iniciar bot
npm start
```

## 📱 Uso del Bot

### 1. Obtener código QR:
Al ejecutar `npm start`, el QR aparece **directamente en la terminal** de Termux:

```
==================================================
📱 CÓDIGO QR PARA WHATSAPP BUSINESS
==================================================

█████████████████████████████████████████
█████████████████████████████████████████
████ ▄▄▄▄▄ █▀█ █▄▀▄▄▀▄ ▄▄▄▄▄ ████
████ █   █ █▀▀▀█ ▀ ▀█▀▀█   █ ████
████ █▄▄▄█ █▀ █▀▀▄██▀▄██▄▄▄█ ████
[... QR CODE ...]

✅ QR generado correctamente
📲 Abre WhatsApp Business > Dispositivos vinculados
==================================================
```

### 2. Escanear con WhatsApp Business:
- Abre **WhatsApp Business** (no WhatsApp normal)
- Ve a **Configuración** → **Dispositivos vinculados**
- Toca **"Vincular dispositivo"**
- Escanea el código QR

### 3. Crear grupo:
- Crea un grupo llamado que contenga **"PEDIDOS"** y **"DAATCS"**
- Ejemplo: "PEDIDOS DAATCS", "Grupo Pedidos DAATCS", etc.
- El bot se conectará automáticamente

## 🤖 Comandos del Bot

### Para Clientes:
```bash
/nuevo [descripción]     # Crear nuevo pedido
/info [ID]              # Ver detalles de pedido
/lista                  # Ver pedidos activos
/ayuda                  # Ver todos los comandos
```

### Para Administradores:
```bash
/estado [ID] [estado]   # Cambiar estado de pedido
/stats                  # Ver estadísticas completas
/salud                  # Estado del bot
```

### Estados Disponibles:
- `pendiente`, `confirmado`, `proceso`
- `diseño`, `produccion`, `control`
- `listo`, `entregado`, `cancelado`

## 💡 Ejemplos de Uso

```bash
# Cliente crea pedido
/nuevo Camiseta talla M color azul con logo personalizado

# Bot responde con ID
✅ PEDIDO CREADO EXITOSAMENTE
🆔 ID: #001
👤 Cliente: Juan Pérez
📊 Estado: PENDIENTE

# Admin cambia estado
/estado 001 confirmado

# Cliente consulta estado
/info 001
```

## 🔧 Scripts Útiles para Termux

Después de la instalación automática, tendrás estos scripts:

```bash
# Iniciar bot normal
./start-bot.sh

# Iniciar con PM2 (24/7)
./start-pm2.sh

# Regenerar QR si hay problemas
./regenerate-qr.sh

# Hacer backup
./backup-data.sh
```

## 📊 Monitoreo

### URLs disponibles (cuando el bot esté activo):
- **Estado general**: `http://localhost:3000`
- **Código QR**: `http://localhost:3000/qr`
- **Estadísticas**: `http://localhost:3000/stats`

### Comandos PM2:
```bash
pm2 logs daatcs-bot      # Ver logs en tiempo real
pm2 stop daatcs-bot      # Detener bot
pm2 start daatcs-bot     # Iniciar bot
pm2 restart daatcs-bot   # Reiniciar bot
```

## 🛠️ Solución de Problemas

### QR no aparece:
```bash
# Método 1: Regenerar sesión
cd ~/bot-daatcs
./regenerate-qr.sh

# Método 2: Limpiar cache
rm -rf auth_data
npm start

# Método 3: Reinstalar dependencias
npm install --force
```

### Bot se desconecta:
```bash
# Verificar logs
pm2 logs daatcs-bot

# Reiniciar bot
pm2 restart daatcs-bot

# Si persiste el problema
./regenerate-qr.sh
```

### Error de memoria en Termux:
```bash
# Limpiar cache
npm cache clean --force

# Reiniciar Termux
exit
# Reabrir Termux y ejecutar:
cd ~/bot-daatcs && ./start-bot.sh
```

### Grupo no encontrado:
1. Verifica que el grupo contenga "PEDIDOS" y "DAATCS" en el nombre
2. Usa **WhatsApp Business**, no WhatsApp normal
3. Revisa logs: `pm2 logs daatcs-bot`

## 🌐 Despliegue en Railway

### Para Railway, usa el método original:
1. Fork este repositorio
2. Ve a [Railway.app](https://railway.app)
3. Conecta tu GitHub
4. Deploy desde tu fork
5. Railway detectará automáticamente la configuración

## 📁 Estructura de Archivos

```
bot-daatcs/
├── bot.js                 # Bot principal (dual environment)
├── package.json           # Dependencias
├── install-termux.sh      # Instalador para Termux
├── start-bot.sh          # Script de inicio
├── start-pm2.sh          # Script PM2
├── regenerate-qr.sh      # Regenerar QR
├── backup-data.sh        # Backup de datos
├── database/
│   ├── pedidos.json      # Base de datos principal
│   └── backup-*.json     # Backups automáticos
├── auth_data/            # Sesión de WhatsApp
└── README.md             # Esta guía
```

## 🔒 Características de Seguridad

- **Límites de mensajes**: Protección anti-ban
- **Horarios de servicio**: 6:00 AM - 10:00 PM
- **Delays inteligentes**: Entre mensajes
- **Backup automático**: Cada 6 horas
- **Validación de permisos**: Admin vs usuarios
- **Logs detallados**: Para debugging

## 📈 Estadísticas y Monitoreo

El bot registra automáticamente:
- Mensajes procesados
- Comandos ejecutados
- Pedidos por estado
- Errores y rendimiento
- Tiempo de actividad

## 🤝 Contribuir

1. Fork el repositorio
2. Crea una rama para tu feature
3. Commit tus cambios
4. Push a la rama
5. Abre un Pull Request

## 📄 Licencia

MIT License - Ver archivo LICENSE para más detalles.

## 📞 Soporte

Si tienes problemas:

1. **Revisa los logs**: `pm2 logs daatcs-bot`
2. **Verifica el estado**: `http://localhost:3000`
3. **Regenera QR**: `./regenerate-qr.sh`
4. **Consulta Issues**: [GitHub Issues](https://github.com/JR23CR/bot-daatcs-railway/issues)

---

## ✅ Lista de Verificación

Después de instalar, verifica:

- [ ] ✅ Termux configurado con storage
- [ ] ✅ Node.js y dependencias instaladas
- [ ] ✅ Bot clonado en `~/bot-daatcs`
- [ ] ✅ QR visible en terminal
- [ ] ✅ WhatsApp Business conectado
- [ ] ✅ Grupo creado con nombre correcto
- [ ] ✅ Comandos funcionando (`/ayuda`)
- [ ] ✅ PM2 configurado para 24/7

**¡Tu sistema de pedidos DAATCS está listo! 🚀**

---

🏭 **DAATCS - Sistema Profesional de Gestión de Pedidos**
